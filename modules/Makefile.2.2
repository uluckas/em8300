# where the kernel sources are located
KERNEL_LOCATION=/usr/src/linux

#################################################
# some magic for using linux kernel settings
# when compiling module(s)


EXTRA_CFLAGS = -g -Werror -I../include -I/usr/local/include \
		-DEM8300_VIDEOMODE_DEFAULT=EM8300_VIDEOMODE_PAL \
		-DEM8300_AUDIOMODE_DEFAULT=EM8300_AUDIOMODE_ANALOG \
		-DI2C_BITBANGING

O_TARGET 	= em8300.o
O_OBJS 		= em8300_main.o em8300_i2c.o em8300_audio.o em8300_fifo.o \
		  em8300_video.o em8300_misc.o em8300_dicom.o em8300_ucode.o \
		  em8300_ioctl.o em8300_spu.o em9010.o
M_OBJS 		= em8300.o adv717x.o adv717x_eeprom.o bt865.o
MX_OBJS      	= 

here:
	DIR=`pwd`; (cd $(KERNEL_LOCATION); make SUBDIRS=$$DIR modules)

dep:
	DIR=`pwd`; (cd $(KERNEL_LOCATION); make SUBDIRS=$$DIR dep)

clean:
	-rm -f $(O_OBJS) $(M_OBJS) $(MX_OBJS) .depend .*.o.flags *~

include $(KERNEL_LOCATION)/Rules.make

install: $(M_OBJS)
	 @for module in $^ ;\
	 do \
	 install -D $$module $(prefix)/lib/modules/`uname -r`/misc/$$module ;\
	 echo $$module ;\
	 done
	 @depmod -a
	 @echo Installed to running kernel
	
