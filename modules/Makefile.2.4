# where the kernel sources are located
KERNEL_LOCATION=/usr/src/linux

#################################################
# some magic for using linux kernel settings
# when compiling module(s)


EXTRA_CFLAGS = -g -Werror -I/usr/local/include \
	       -DEM8300_VIDEOMODE_DEFAULT=EM8300_VIDEOMODE_PAL \
		-DEM8300_AUDIOMODE_DEFAULT=EM8300_AUDIOMODE_ANALOG
O_TARGET 	=

list-multi 	:= em8300.o
em8300-objs 	:= em8300_main.o em8300_i2c.o em8300_audio.o em8300_fifo.o \
		  em8300_video.o em8300_misc.o em8300_dicom.o em8300_ucode.o \
		  em8300_ioctl.o em8300_spu.o em9010.o
obj-y		:=
obj-m		:= em8300.o adv717x.o eeprom.o bt865.o
obj-n		:=
obj-		:=

srcs            := em8300_main.c em8300_i2c.c em8300_audio.c em8300_fifo.c \
		  em8300_video.c em8300_misc.c em8300_dicom.c em8300_ucode.c \
		  em8300_ioctl.c em8300_spu.c bt865.o em9010.c

here: $(srcs)
	DIR=`pwd`; (cd $(KERNEL_LOCATION); make SUBDIRS=$$DIR modules)

$(srcs):

dep:
	DIR=`pwd`; (cd $(KERNEL_LOCATION); make SUBDIRS=$$DIR dep)

clean:
	-rm -f $(obj-m) $(em8300-objs)  .depend .*.o.flags *~

include $(KERNEL_LOCATION)/Rules.make

em8300.o: $(em8300-objs)
	$(LD) -r -o $@ $(em8300-objs)
